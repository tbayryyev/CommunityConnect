<div class="container" id="eventContainer" data-event-id="{{event._id}}">
  <!-- Event Details -->
  <div class="row justify-content-center mt-5">
    <div class="col-md-8">
      <div class="card border-0 shadow-lg">
        <div class="card-body text-center">
          <div class="row">
            <div class="col-md-6">
              <img src="https://cloudfront-us-east-2.images.arcpublishing.com/reuters/7YKAJ3JWWJNL7PGRPZKY2TEU5Y.jpg" class="img-fluid event-image " alt="{{event.eventName}} Image">
            </div>
            <div class="col-md-6">
              <h1 class="card-title">{{event.eventName}}</h1>
              <p class="card-text"><strong>Location:</strong> {{event.eventLocation}}</p>
              <p class="card-text"><strong>Description:</strong> {{event.description}}</p>
              <p class="card-text"><strong>Date:</strong> {{event.eventDate}}</p>
              <p class="card-text"><strong>Time:</strong> {{event.eventTime}}</p>
              <p class="card-text"><strong>Cost:</strong> ${{event.cost}}</p>
              {{#if event.link}}
                <p class="card-text"><strong>Link:</strong> <a href="{{event.link}}" target="_blank">{{event.link}}</a></p>
              {{/if}}
              <p>Posted by: {{event.eventUsername}}</p>
              <button type="button" class="btn btn-primary btn-interested btn-block">Interested</button>
              <p class="mt-3">{{event.interestCount}} users are interested in this event!</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="container">
  <!-- Comments Section -->
  <div class="row justify-content-center mt-5">
    <div class="col-md-8">
      <div class="card border-0 shadow-lg">
        <div class="card-body">
          <h3 class="card-title text-center mb-4">Comments</h3>
          <!-- Form for adding a new comment -->
          <form id="commentForm" action="/addComment/{{event._id}}" method="POST">
            <div class="form-group">
              <textarea class="form-control" id="commentText" name="commentText" rows="3" placeholder="Add your comment here"></textarea>
            </div>
            <!-- You might add more fields for user info, etc., if needed -->
            <button type="submit" class="btn btn-primary btn-block">Submit</button>
          </form>

          <!-- Display existing comments -->
          <div class="mt-4 commentSection">
            {{#each event.comments}}
              <div class="comment bg-light p-3 rounded mb-3">
                <p class="mb-1">{{this.commentText}}</p>
                <p class="text-muted small">Posted by: {{this.username}}</p>
              </div>
            {{/each}}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
$(document).ready(function () {
  // Submit comment form
  $('#commentForm').submit(function (event) {
    event.preventDefault(); // Prevent the default form submission

    var commentText = $('#commentText').val(); // Get the comment text from the form
    var eventId = $('#eventContainer').data('event-id'); // Retrieve the event ID from the data attribute

    // AJAX POST request to submit the comment
    $.ajax({
      type: 'POST',
      url: '/addComment/' + eventId,
      data: { commentText: commentText },
      success: function (response) {
        var newComment = '<div class="comment bg-light p-3 rounded mb-3">' +
          '<p class="mb-1">' + response.commentText + '</p>' +
          '<p class="text-muted small">Posted by: ' + response.username + '</p>' +
          '</div>';

        var $newComment = $(newComment).hide(); // Hide the new comment initially
        $('.commentSection').append($newComment);

        // Scroll to the new comment after it's appended
        $newComment.slideDown('fast', function () {
          $('html, body').animate({
            scrollTop: $(this).offset().top
          }, 'slow');
        });

        // Clear the comment input field
        $('#commentText').val('');
      },
      error: function (error) {
        console.error('Error adding comment:', error);
        // Handle errors here (e.g., display an error message)
      }
    });
  });
});
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
  const interestedButton = document.querySelector('.btn-interested');
  console.log(interestedButton);


  if (interestedButton) {
    interestedButton.addEventListener('click', function (event) {
      try {
        var eventId = $('#eventContainer').data('event-id'); // Retrieve the event ID from the data attribute
        
        // Check if eventId is retrieved successfully
        if (!eventId) {
          console.error('Error: eventId is not retrieved.');
          return;
        }

        // AJAX POST request to submit the comment
        $.ajax({
          type: 'POST',
          url: '/toggleInterestButton/' + eventId,
          success: function (response) {
            // Handle the success response from the server if needed
            console.log(response);

            // Toggle the 'btn-success' class to change the button color
            interestedButton.classList.toggle('btn-success');
          },
          error: function (error) {
            console.error('Error toggling button:', error);
            // Handle errors here (e.g., display an error message)
          }
        });
      } catch (err) {
        console.error('Unexpected error:', err);
      }
    });
  }
});
</script>