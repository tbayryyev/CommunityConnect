<div class="container">
  <h1 class="my-4 text-center mt-5">Upcoming Events</h1>

  <div class="row">
    {{#each events}}
      <div class="col-lg-4 col-md-6 mb-4">
        <div class="card h-100" data-event-id="{{this._id}}">
          <img src="/uploads/user-uploaded-images/{{this.imageFileName}}" class="card-img-top" alt="{{this.eventName}} Image">
          <div class="card-body">
            <h5 class="card-title">
              <a href="/event/{{this._id}}" class="event-link">{{this.eventName}}</a>
            </h5>
            <p class="card-text"><strong>Location:</strong> {{this.eventLocation}}</p>
            <p class="card-text"><strong>Description:</strong> {{this.description}}</p>
            <p class="card-text"><strong>Date:</strong> {{this.eventDate}}</p>
            <p class="card-text"><strong>Time:</strong> {{this.eventTime}}</p>
            <p class="card-text"><strong>Cost:</strong> ${{this.cost}}</p>
            <p class="card-text"><small class="text-muted">Posted by: {{this.eventUsername}}</small></p>
          </div>
          {{#if ../username}}
          <div class="card-footer">
            <button type="button" class="btn btn-primary btn-interested btn-block">Interested</button>
            <p class="text-center mt-2 interest-count"><small>{{this.interestCount}} users are interested in this event!</small></p>
          </div>
            {{/if}}
        </div>
      </div>
    {{/each}}
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const eventCards = document.querySelectorAll('.card');

  eventCards.forEach(function (card) {
    var eventId = card.dataset.eventId;
    var interestedButton = card.querySelector('.btn-interested');
    var interestCountElement = card.querySelector('.interest-count');


  // checking if the user is interested in the event then make the button green
    $.ajax({
      type: 'GET',
      url: '/checkInterstedUser/' + eventId,
      success: function (response) {
        if (response.interstedUser === true) {
          interestedButton.classList.add('btn-success');
        }
      },
      error: function (error) {
        console.error('Error checking interest:', error);
        // Handle errors here
      }
    });

    // adding the user to the interstedUser array after clicking the intersted button
    interestedButton.addEventListener('click', function () {
      $.ajax({
        type: 'POST',
        url: '/toggleInterestButton/' + eventId,
        success: function (response) {
          interestedButton.classList.toggle('btn-success');
          if (interestCountElement) {
            interestCountElement.textContent = response.interestCount + ' users are interested in this event!';
            interestCountElement.style.fontSize = 'small'; // Set font size inline
          }
        },
        error: function (error) {
          console.error('Error toggling button:', error);
          // Handle errors here
        }
      });
    });
  });
});

</script>